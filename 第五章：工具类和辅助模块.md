# 第五章：工具类和辅助模块

## 5.1 工具类概述

在 Android 开发中，工具类（Utils）是非常重要的组成部分。它们封装了常用的函数和方法，使得开发者能够快速实现各种功能，而无需每次都重复编写代码。

本项目中有丰富的工具类，主要分为两大类：
1. 项目自定义的工具类
2. 第三方库提供的工具类

## 5.2 项目自定义工具类

### 管理器类（Manager）

项目中有一系列以 Manager 结尾的类，它们负责管理特定的功能模块。

#### ActivityManager 活动管理器

[ActivityManager](file:///D:/git/app/AndroidProject/app/src/main/java/run/yigou/gxzy/manager/ActivityManager.java#L20-L143) 负责管理应用中所有的 Activity 实例。

主要功能：
- 记录当前运行的所有 Activity
- 提供获取栈顶 Activity 的方法
- 管理 Activity 的生命周期回调

```java
// 获取 ActivityManager 实例
ActivityManager activityManager = ActivityManager.getInstance();

// 获取栈顶的 Activity
Activity topActivity = activityManager.getTopActivity();

// 结束所有 Activity
activityManager.finishAllActivities();
```

#### InputTextManager 输入文本管理器

[InputTextManager](file:///D:/git/app/AndroidProject/app/src/main/java/run/yigou/gxzy/manager/InputTextManager.java#L22-L203) 用于管理多个输入框的输入状态，并根据输入情况自动启用或禁用按钮。

使用示例：
```java
// 创建输入管理器，关联登录按钮
InputTextManager inputManager = InputTextManager.with(loginButton, true);

// 添加需要监控的输入框
inputManager.add(usernameEditText);
inputManager.add(passwordEditText);

// 当所有输入框都有内容时，登录按钮自动启用
// 当任一输入框为空时，登录按钮自动禁用
```

#### ThreadPoolManager 线程池管理器

负责管理应用中的线程池，避免频繁创建和销毁线程。

```java
// 执行后台任务
ThreadPoolManager.getInstance().execute(() -> {
    // 后台任务代码
});

// 在主线程执行任务
ThreadPoolManager.getInstance().postMain(() -> {
    // 更新UI的代码
});
```

### 工具类（Utils）

#### CacheDataManager 缓存数据管理

负责管理应用的缓存数据，包括清理缓存等功能。

```java
// 获取缓存大小
String cacheSize = CacheDataManager.getTotalCacheSize(context);

// 清理缓存
CacheDataManager.clearAllCache(context);
```

#### SerialUtil 序列号工具

生成设备唯一标识符。

```java
// 获取设备序列号
String serial = SerialUtil.getSerial();
```

## 5.3 第三方工具类

### AndroidUtilCode 工具库

项目集成了 AndroidUtilCode 工具库，提供了大量实用的工具方法。

#### GsonUtils JSON 工具

用于 JSON 的序列化和反序列化。

```java
// 对象转 JSON 字符串
String json = GsonUtils.toJson(object);

// JSON 字符串转对象
Person person = GsonUtils.fromJson(json, Person.class);
```

#### ToastUtils 吐司工具

用于显示提示信息。

```java
// 显示短时间提示
ToastUtils.showShort("操作成功");

// 显示长时间提示
ToastUtils.showLong("请注意！");
```

### 其他第三方工具

#### MMKV 轻量级存储

替代 SharedPreferences 的高性能键值存储框架。

```java
// 获取 MMKV 实例
MMKV mmkv = MMKV.defaultMMKV();

// 存储数据
mmkv.putString("username", "张三");
mmkv.putInt("age", 25);

// 读取数据
String username = mmkv.getString("username", "");
int age = mmkv.getInt("age", 0);
```

#### EventBus 事件总线

用于组件间的通信。

```java
// 注册事件监听
XEventBus.getDefault().register(this);

// 发送事件
XEventBus.getDefault().post(new LoginSuccessEvent());

// 接收事件
@Subscribe
public void onLoginSuccess(LoginSuccessEvent event) {
    // 处理登录成功的逻辑
}

// 取消注册
XEventBus.getDefault().unregister(this);
```

## 5.4 辅助模块

### AOP 面向切面编程

项目中使用 AspectJ 实现了面向切面编程，主要包括：

#### 权限检查 [@Permissions](file:///D:/git/app/AndroidProject/app/src/main/java/run/yigou/gxzy/aop/Permissions.java#L23-L32)

自动检查权限，避免重复代码。

```java
@Permissions(Permission.CAMERA)
private void takePhoto() {
    // 拍照逻辑，会自动检查相机权限
}
```

#### 网络检查 [@CheckNet](file:///D:/git/app/AndroidProject/app/src/main/java/run/yigou/gxzy/aop/CheckNet.java#L14-L22)

自动检查网络连接状态。

```java
@CheckNet
private void loadData() {
    // 加载数据，会自动检查网络
}
```

#### 防重复点击 [@SingleClick](file:///D:/git/app/AndroidProject/app/src/main/java/run/yigou/gxzy/aop/SingleClick.java#L14-L22)

防止用户快速多次点击按钮。

```java
@SingleClick
private void onLoginButtonClick() {
    // 登录逻辑，防止重复点击
}
```

#### 日志记录 [@Log](file:///D:/git/app/AndroidProject/app/src/main/java/run/yigou/gxzy/aop/Log.java#L14-L22)

自动记录方法调用日志。

```java
@Log
private void processData() {
    // 处理数据，会自动记录方法调用日志
}
```

## 5.5 自定义 View 组件

项目中还包含了许多自定义的 View 组件，位于 [widget](file:///D:/git/app/AndroidProject/app/src/main/java/run/yigou/gxzy/widget) 包中：

### 状态布局 [StatusLayout](file:///D:/git/app/AndroidProject/app/src/main/java/run/yigou/gxzy/widget/StatusLayout.java#L31-L339)

用于显示加载中、空数据、错误等不同状态的布局。

```java
// 设置状态监听器
statusLayout.setOnRetryListener(v -> {
    // 重试逻辑
});

// 显示加载中状态
statusLayout.showLoading();

// 显示错误状态
statusLayout.showError(R.string.common_network_error);

// 显示空数据状态
statusLayout.showEmpty();
```

### 浏览器视图 [BrowserView](file:///D:/git/app/AndroidProject/app/src/main/java/run/yigou/gxzy/widget/BrowserView.java#L28-L179)

封装了 WebView 的浏览器组件。

```java
// 加载网页
browserView.loadUrl("https://www.baidu.com");

// 设置浏览器回调
browserView.setBrowserCallback(new BrowserView.BrowserCallback() {
    @Override
    public void onPageStarted() {
        // 页面开始加载
    }
    
    @Override
    public void onPageFinished() {
        // 页面加载完成
    }
});
```

## 5.6 在 Application 中初始化工具类

在 [AppApplication](file:///D:/git/app/AndroidProject/app/src/main/java/run/yigou/gxzy/app/AppApplication.java#L58-L317) 中统一初始化各种工具类：

```java
public class AppApplication extends Application {
    
    @Override
    public void onCreate() {
        super.onCreate();
        
        // 初始化工具类
        initSdk(this);
    }
    
    private void initSdk(Application application) {
        // 初始化吐司工具
        ToastUtils.init(application, new ToastStyle());
        
        // 初始化 MMKV
        MMKV.initialize(application);
        
        // 初始化 Activity 管理器
        ActivityManager.getInstance().init(application);
        
        // 初始化线程池管理器
        ThreadPoolManager.getInstance().init();
        
        // 其他工具类初始化...
    }
}
```

## 本章小结

这一章我们学习了：

1. 项目中各种自定义的管理器类及其用途
2. 第三方工具库的使用方法
3. AOP 面向切面编程在项目中的应用
4. 自定义 View 组件的使用
5. 工具类在 Application 中的初始化过程

掌握这些工具类和辅助模块，可以帮助你更高效地开发 Android 应用，避免重复造轮子，提高代码质量和开发效率。