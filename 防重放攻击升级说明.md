# 防重放攻击签名机制升级说明

## 1. 升级背景

根据服务端 `anti-replay-attack.md` 文档的更新（2025-12 变更），签名机制发生了重大调整。为确保客户端与服务端的一致性，我们需要同步更新客户端的签名算法实现。

## 2. 主要变更内容

### 2.1 签名字符串格式变更

**原签名格式**（变更前）：
```
Method
Host
Path
Query
Body
Timestamp
Nonce
```

**新签名格式**（变更后，2025-12）：
```
Method
Host
Path
Timestamp
Nonce
```

### 2.2 变更原因

根据官方文档说明，此次变更是为了：
1. 避免因查询参数(Query)和请求体(Body)在不同语言环境中受到编码、大小写、空格及压缩方式影响而导致的签名不一致问题
2. 减少多端互操作时的歧义
3. 简化签名算法，提高验证效率

## 3. 代码实现变更

### 3.1 SecurityConfig 类调整

1. 修改了 `generateSignature` 方法签名，去除了 `queryString` 和 `bodyString` 参数
2. 调整了签名字符串构造逻辑，仅保留 Method/Host/Path/Timestamp/Nonce 五个部分

### 3.2 InterceptorHelper 类调整

1. 调整了 `generateSignature` 方法的调用方式，不再传递查询参数和请求体
2. 预先生成时间戳和Nonce，并在签名和请求头中复用，确保一致性

## 4. 影响范围

此次变更仅影响防重放攻击的签名生成逻辑，不影响其他功能。所有使用 EasyHttp 框架的网络请求将继续正常工作。

## 5. 验证方式

升级后可通过以下方式验证功能是否正常：
1. 确认请求头中包含 X-Timestamp 和 X-Nonce 字段
2. 确认 Signature 的值是基于新格式生成的
3. 服务端应能正确验证新的签名格式